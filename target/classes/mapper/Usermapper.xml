<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunstar.dao.CustomerDAO">
	<resultMap type="com.sunstar.dto.CustomerDTO" id="customerMap">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="tel" column="tel" />
		<result property="email" column="email"/>
		<result property="password" column="password" />
		<result property="address1" column="address1" />
		<result property="address2" column="address2" />
		<result property="address3" column="address3" />
		<result property="zip" column="zip" />
		<result property="enable" column="enable" />
		<result property="join_date" column="join_date" />
		<collection property="authlist" resultMap="authMap"></collection>
	</resultMap>

	<resultMap type="com.sunstar.dto.AuthDTO" id="authMap">
		<result property="id" column="id" />
		<result property="auth" column="auth"/>
	</resultMap>
	
	<select id="getUserById" resultMap="customerMap" parameterType="string">
	select c.*, auth
	from customer c left join auth
	on c.id=auth.id
	where c.id=#{userid}
	</select>
	
	<select id="customeridcheck" resultType="int" parameterType="string">
	select count(*)
	from customer
	where id=#{id}
	</select>
	
	<select id="customerpwcheck" resultType="int" parameterType="string">
	select count(*)
	from customer
	where id=#{id} and password=#{pw}
	</select>
	
	
	<select id="customeremailcheck" resultType="int" parameterType="string">
	select count(*)
	from customer
	where email=#{email}
	</select>
	
	<insert id="join_Customer" parameterType="com.sunstar.dto.CustomerDTO">
  	insert into customer(id, name, tel, email, password, address1, address2, address3, zip, enable, join_date)
  	values(#{id}, #{name}, #{tel}, #{email}, #{password}, #{address1}, #{address2}, #{address3}, #{zip}, #{enable}, now())
  	</insert>
  	
  	<insert id="join_Customer_auth" parameterType="com.sunstar.dto.CustomerDTO">
  	insert into auth values 
  	<foreach collection="authlist" item="item" 
  	separator=", " close=" " >
  	(#{item.id},#{item.auth})
  	</foreach>
  	</insert>
  	
</mapper>