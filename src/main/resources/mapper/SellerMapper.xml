<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunstar.mapper.SellerMapper">


	<!-- 카테고리 목록 불러오기 -->
	<select id="getCategory" resultType="com.sunstar.dto.CategoryDTO">
		select * from category
	</select>
	
	<!-- 2차 카테고리 갯수 반환 -->
	<select id="getCategoryCount" resultType="int">
		select distinct lv2 from category;
	</select>
	
	<!-- 상품 추가  -->
	<insert id="addProduct" parameterType="com.sunstar.dto.ProductDTO">
		insert into product_list(product_name, price, cost, shipping_cost, thumb_img,explains, public_state, review_state, category_code, seller_code, add_date)
		values(#{product_name},#{price},#{cost},#{shipping_cost},#{thumb_img},#{explains},#{public_state},#{review_state}, #{category_code}, #{seller_code}, now() )
	</insert>
	
	<!--  -->
	<select id="aProduct" resultType="int">
		select product_code
		from product_list 
		where product_code = (select max(product_code) from product_list)
	</select>
	
	<!-- 옵션 추가  -->
	<insert id="addOptions" parameterType="com.sunstar.dto.OptionDTO">

		insert into options(product_code, size, color, inventory, add_price)
		values(#{product_code},#{size},#{color},#{inventory},#{add_price})
	
	</insert>
	
	<!-- 상픔 리스트 (판매자) -->
	<select id="list" resultType="com.sunstar.dto.ProductDTO">
		select p.product_code, product_name, price, cost, shipping_cost, o.size, o.color, o.inventory, o.add_price, public_state, review_state, c.lv1, c.lv2, c.lv3
		from product_list p  join category c
		on p.category_code = c.category_code
		left join options o
        on p.product_code = o.product_code
		order by product_code desc
	</select>
	
	<!-- 옵션 삭제 -->
	<delete id="deleteProductOptions" parameterType="int">
		delete from options where product_code=#{product_code}
	</delete>	
	
	<!-- 상품 삭제  -->
	<delete id="deleteProduct" parameterType="int">
		delete from product_list where product_code=#{product_code}
	</delete>	
	
	<!-- 옵션 가지수 가져오기  -->
	<select id="getOptionColor" parameterType="int" resultType="string">
		select color
		from options
		where product_code=#{product_code}
		order by product_code desc
	</select>
	
	<!-- 재고 업데이트 -->
	<update id="updateInventory" parameterType="com.sunstar.dto.OptionDTO">
		update options 
		set inventory = inventory+#{inventory}
		where product_code=#{product_code} and color=#{color}
	</update>
	
</mapper>