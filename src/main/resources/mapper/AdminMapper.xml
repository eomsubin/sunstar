<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sunstar.mapper.AdminMapper">
	<select id="getSellerApply" parameterType="string" resultType="hashmap">
	select distinct * 
	from seller s join auth a 
	on s.id = a.id 
	
	where not s.id in 
						(select s.id 
						 from seller s join auth a 
						 on s.id = a.id 
						 where auth = "ROLE_MANAGER")
	</select>	
	<select id="getSellerList" parameterType="string" resultType="hashmap">
	select  * 
	from seller s join auth a 
	on s.id = a.id where auth = "ROLE_MANAGER"	
	order by seller_code desc
	</select>
	
	<select id="getLv1" resultType="com.sunstar.dto.CategoryDTO">
		 select distinct lv1 from category
	
	</select>
	
	<select id="getLv2"  resultType="com.sunstar.dto.CategoryDTO" parameterType="string">
		select distinct lv2,lv1,lv2code from category
		
	 
	</select>
		<select id="getLv3"  resultType="com.sunstar.dto.CategoryDTO" parameterType="string">
		select distinct lv3,lv2,lv2code,category_code from category
	
	</select>
	
	<insert id="add_lv2" parameterType="com.sunstar.dto.CategoryDTO">
		<selectKey keyProperty="lv2code,category_code" order="BEFORE" resultType="com.sunstar.dto.CategoryDTO" >
			   select concat(#{lv2con},lpad(max(substr(category_code,2,4))+1,4,"0")) as category_code, concat(#{lv2con},lpad(max(substr(lv2code,2,3))+1,2,"0")) as lv2code
   			 	from category
    			where lv1= #{lv1}
		</selectKey>
	
		insert into category(lv2,lv2code,lv1,category_code,lv3)
		values(#{lv2},#{lv2code},#{lv1},#{category_code},#{lv3})
	
	</insert>
	
	
</mapper>